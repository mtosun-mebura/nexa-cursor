import"./frontend-app-B6vhmd6y.js";let g=[],u=null,V=null,X=null,R=null,v=null,L=!1,w=!1,_=!1,D=!1,j=!1,B=!1;window.openChatWithCandidate=function(e,s,t){if(!e)return;_=!1;const r=document.getElementById("chat_drawer"),n=document.getElementById("chat_drawer_backdrop");r&&r.removeAttribute("data-drawer-closed");const i=document.querySelector('[data-kt-drawer-toggle="#chat_drawer"]');if(i)i.click();else if(r){const a=window.KTDrawer?.getInstance?.(r);a?a.show():r.classList.remove("hidden")}const o=new FormData;o.append("candidate_id",e),s&&s!=="null"&&s!==null&&t&&t!=="null"&&t!==""&&(t==="match"?o.append("match_id",s):t==="application"&&o.append("application_id",s)),L=!0;const d=document.getElementById("chat_list_view"),c=document.getElementById("chat_messages_view");d&&(d.style.setProperty("display","none","important"),d.style.setProperty("visibility","hidden","important"),d.style.setProperty("opacity","0","important")),c&&(c.style.setProperty("display","flex","important"),c.style.setProperty("visibility","visible","important"),c.style.setProperty("opacity","1","important"),c.classList.remove("hidden")),setTimeout(()=>{fetch("/admin/chat/start",{method:"POST",headers:{"X-CSRF-TOKEN":S()},body:o}).then(a=>a.json()).then(a=>{if(a.success){if(L=!0,u=a.chat_id,a.chat){const p=g.findIndex(y=>y.id===a.chat.id);p===-1?g.unshift(a.chat):g[p]=a.chat,v=a.chat}if(r){r.setAttribute("data-chat-active","true"),r.setAttribute("data-ignore-observer","true"),window.chatDrawerObserver&&window.chatDrawerObserver.disconnect();const p=()=>{w=!0;try{r.style.setProperty("transform","translateX(0)","important"),r.style.setProperty("translate","0 0","important"),r.style.setProperty("right","1.25rem","important"),r.style.setProperty("left","auto","important"),r.style.setProperty("--tw-translate-x","0","important"),r.style.setProperty("inset-inline-start","auto","important"),r.style.setProperty("display","flex","important"),r.style.setProperty("transition","none","important"),r.style.setProperty("animation","none","important"),r.style.left&&r.style.removeProperty("left");const y=r.getAttribute("style");if(y){const b=y.replace(/left\s*:\s*[^;!]+(!important)?;?/gi,"").trim();b!==y&&r.setAttribute("style",b)}r.style.setProperty("left","auto","important")}finally{setTimeout(()=>{w=!1},10)}};p(),requestAnimationFrame(()=>{p(),requestAnimationFrame(()=>{p()})}),setTimeout(p,10),setTimeout(p,50),setTimeout(p,100),setTimeout(p,200),setTimeout(p,300)}n&&n.classList.remove("hidden");const f=document.getElementById("chat_list_view"),l=document.getElementById("chat_messages_view");if(f&&(f.style.setProperty("display","none","important"),f.style.setProperty("visibility","hidden","important"),f.style.setProperty("opacity","0","important")),l&&(l.style.setProperty("display","flex","important"),l.style.setProperty("visibility","visible","important"),l.style.setProperty("opacity","1","important"),l.classList.remove("hidden")),selectChat(a.chat_id),setTimeout(()=>{r&&(r.removeAttribute("data-ignore-observer"),window.chatDrawerObserver&&r&&window.chatDrawerObserver.observe(r,{attributes:!0,attributeFilter:["class"]}))},2e3),a.chat){const p=g.findIndex(y=>y.id===a.chat.id);p===-1?g.unshift(a.chat):g[p]=a.chat,u===a.chat.id&&(v=a.chat)}setTimeout(()=>{B||loadActiveChats(!1).then(()=>{const p=document.getElementById("chat_list_view");p&&!u&&window.getComputedStyle(p).display!=="none"&&O(g)})},600),setTimeout(()=>{L=!1},3e3)}}).catch(a=>{L=!1})},100)};function S(){return document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}window.loadActiveChats=function(e=!1,s=!1){return B?Promise.resolve(g):(B=!0,fetch("/admin/chat/active",{headers:{"X-CSRF-TOKEN":S()},cache:"no-cache"}).then(t=>{if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(t=>{if(!Array.isArray(t)||t.error)return g;const r=t.map(d=>d.id);g.map(d=>d.id),t.forEach(d=>{const c=g.find(a=>a.id===d.id);if(c&&c.unread_count!==void 0){const a=d.unread_count||0,f=c.unread_count||0;d.unread_count=Math.max(a,f)}});const n=g.find(d=>d.id===u);u&&n&&!r.includes(u)&&t.push(n),g.length,g=[...t];const i=document.getElementById("chat_list_view"),o=document.getElementById("chat_messages_view");return(!u||e)&&(i&&(i.style.setProperty("display","flex","important"),i.style.setProperty("visibility","visible","important"),i.style.setProperty("opacity","1","important")),o&&(o.style.setProperty("display","none","important"),o.style.setProperty("visibility","hidden","important"),o.style.setProperty("opacity","0","important")),e&&(u=null,v=null)),O(g),B=!1,g}).catch(t=>(B=!1,g)))};function te(e){const s=document.getElementById("chat_list");if(!s)return;const t=s.querySelector(`.chat-item[data-chat-id="${e}"]`);if(!t)return;t.classList.remove("chat-ended");const r=t.querySelector(".ki-cross-circle");r&&r.remove()}function Q(e){const s=document.getElementById("chat_list");s&&e.forEach(t=>{const r=s.querySelector(`.chat-item[data-chat-id="${t.id}"]`);if(!r)return;const n=t.unread_count||0,i=r.querySelector(".bg-accent\\/60.size-11, .bg-accent\\/60");if(!i)return;const o=i.querySelector(".absolute.top-0.end-0");if(o&&o.remove(),n>0){const d=document.createElement("span");d.className="absolute top-0 end-0 flex items-center justify-center w-[18px] h-[18px] rounded-full bg-red-500 text-white text-[10px] font-semibold leading-none z-10",d.style.boxSizing="border-box",d.style.backgroundColor="rgb(239, 68, 68)",d.style.color="white",d.style.display="flex",d.style.visibility="visible",d.style.opacity="1",d.style.position="absolute",d.style.top="-2px",d.style.right="-2px",d.style.zIndex="10",d.style.width="18px",d.style.height="18px",d.style.borderRadius="50%",d.style.transform="none",d.textContent=n>9?"9+":n.toString(),i.appendChild(d)}})}function O(e){const s=document.getElementById("chat_list"),t=document.getElementById("chat_list_empty"),r=document.getElementById("chat_list_view");if(!s)return;r&&!u?(r.style.setProperty("display","flex","important"),r.style.setProperty("visibility","visible","important"),r.style.setProperty("opacity","1","important")):r&&u&&(r.style.setProperty("display","none","important"),r.style.setProperty("visibility","hidden","important"),r.style.setProperty("opacity","0","important")),se(),t&&(t.style.display=e.length===0?"flex":"none");const n=s.querySelectorAll(".chat-item"),i=n.length,o=Array.from(n).map(l=>parseInt(l.getAttribute("data-chat-id"))),d=e.map(l=>l.id).sort((l,p)=>l-p),c=o.sort((l,p)=>l-p);if(i>0&&i===e.length&&JSON.stringify(c)===JSON.stringify(d)){Q(e),e.forEach(l=>{const p=s.querySelector(`.chat-item[data-chat-id="${l.id}"]`);if(p&&l.last_message){const y=p.querySelector(".text-xs.text-muted-foreground"),b=p.querySelector(".text-xs.text-gray-500");y&&l.last_message.message&&(y.textContent=l.last_message.message),b&&l.last_message.time&&(b.textContent=l.last_message.time)}}),e.forEach(l=>{const p=s.querySelector(`.chat-item[data-chat-id="${l.id}"]`);if(!p)return;const y=!l.is_active;if(y&&!p.classList.contains("chat-ended"))p.classList.add("chat-ended");else if(!y&&p.classList.contains("chat-ended")){p.classList.remove("chat-ended");const b=p.querySelector(".ki-cross-circle");b&&b.remove()}});return}if(n.forEach(l=>l.remove()),e.length===0)return;[...e].sort((l,p)=>{const y=l.last_message?new Date(l.last_message.created_at).getTime():l.updated_at?new Date(l.updated_at).getTime():0;return(p.last_message?new Date(p.last_message.created_at).getTime():p.updated_at?new Date(p.updated_at).getTime():0)-y}).forEach((l,p)=>{const y=document.createElement("div");y.className=`chat-item p-3 border-b border-border cursor-pointer hover:bg-muted/50 ${l.id===u?"bg-muted/30":""}`,y.setAttribute("data-chat-id",l.id),y.onclick=()=>selectChat(l.id);const b=l.candidate&&l.candidate.name?l.candidate.name:"Onbekend",z=l.last_message?l.last_message.message:"",m=l.last_message&&l.last_message.time?l.last_message.time:"",x=l.candidate&&l.candidate.avatar?l.candidate.avatar:null,h=l.unread_count!==void 0&&l.unread_count!==null?parseInt(l.unread_count):0,C=l.is_ended_by_other_party===!0;l.is_ended_by_current_user;const A=!l.is_active;A&&y.classList.add("chat-ended"),y.innerHTML=`
            <div class="flex items-center gap-3">
                <div class="bg-accent/60 flex size-11 shrink-0 items-center justify-center rounded-full border border-border relative" style="position: relative; overflow: visible;">
                    ${x?`<img src="${P(x)}" alt="${P(b)}" class="w-full h-full rounded-full object-cover" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; border-radius: 50%;" onerror="this.parentElement.innerHTML='<span class=\\'text-primary font-semibold text-sm\\' style=\\'position: relative; z-index: 1;\\'>${b.charAt(0).toUpperCase()}</span>'">`:`<span class="text-primary font-semibold text-sm" style="position: relative; z-index: 1;">${b.charAt(0).toUpperCase()}</span>`}
                    ${h>0?`
                        <span class="absolute top-0 end-0 flex items-center justify-center w-[18px] h-[18px] rounded-full bg-red-500 text-white text-[10px] font-semibold leading-none z-10" style="box-sizing: border-box; background-color: rgb(239, 68, 68) !important; color: white !important; display: flex !important; visibility: visible !important; opacity: 1 !important; position: absolute !important; top: -2px !important; right: -2px !important; z-index: 10 !important; width: 18px !important; height: 18px !important; border-radius: 50% !important; transform: none !important;">
                            ${h>9?"9+":h}
                        </span>
                    `:""}
                </div>
                <div class="flex-1 min-w-0">
                    <div class="font-semibold text-sm flex items-center gap-2">
                        ${P(b)}
                        ${A?`<i class="ki-filled ki-cross-circle text-base ${C?"text-gray-400":"text-gray-500"}" title="${C?"Chat beëindigd door kandidaat":"Chat beëindigd door jou"}" style="font-size: 1rem !important;"></i>`:""}
                    </div>
                    ${z?`<div class="text-xs text-muted-foreground truncate">${P(z)}</div>`:'<div class="text-xs text-muted-foreground">Geen berichten</div>'}
                </div>
                <div class="flex flex-col items-end gap-1 shrink-0">
                    ${m?`<div class="text-xs text-muted-foreground">${m}</div>`:""}
                </div>
            </div>
        `,s.appendChild(y)}),s.querySelectorAll(".chat-item")}function se(){fetch("/admin/chat/candidates",{headers:{"X-CSRF-TOKEN":S()}}).then(e=>e.json()).then(e=>{const s=document.getElementById("chat_candidate_select");s&&e.length>0&&(s.innerHTML='<option value="">Selecteer een kandidaat...</option>'+e.map(t=>`<option value="${t.id}" data-match-id="${t.match_id||""}">${t.name}${t.vacancy_title?" - "+t.vacancy_title:""}</option>`).join(""))}).catch(e=>{})}window.handleCandidateSelect=function(){const e=document.getElementById("chat_candidate_select");if(!e||!e.value)return;const s=e.options[e.selectedIndex],t=e.value,r=s.getAttribute("data-match-id");t&&(openChatWithCandidate(t,r||null,r?"match":"application"),e.value="")};window.selectChat=function(e){if(!e)return;let s=g.find(i=>i.id===e);const t=document.getElementById("chat_drawer"),r=document.getElementById("chat_drawer_backdrop");if(t){_=!1,t.removeAttribute("data-drawer-closed"),t.classList.remove("hidden"),w=!0;try{t.style.setProperty("display","flex","important"),t.style.setProperty("visibility","visible","important"),t.style.setProperty("opacity","1","important"),t.style.setProperty("z-index","99999","important"),t.style.setProperty("transform","translateX(0)","important"),t.style.setProperty("right","1.25rem","important"),t.style.setProperty("left","unset","important"),t.setAttribute("data-chat-active","true"),t.setAttribute("data-ignore-observer","true"),window.chatDrawerObserver&&window.chatDrawerObserver.disconnect();const i=()=>{w=!0;try{t.style.setProperty("transform","translateX(0)","important"),t.style.setProperty("translate","0 0","important"),t.style.setProperty("right","1.25rem","important"),t.style.setProperty("left","auto","important"),t.style.setProperty("--tw-translate-x","0","important"),t.style.setProperty("inset-inline-start","auto","important"),t.style.setProperty("display","flex","important"),t.style.setProperty("transition","none","important"),t.style.setProperty("animation","none","important")}finally{setTimeout(()=>{w=!1},10)}};i(),requestAnimationFrame(()=>{i(),requestAnimationFrame(()=>{i()})}),setTimeout(i,10),setTimeout(i,50),setTimeout(i,100)}finally{setTimeout(()=>{w=!1},150)}}if(r&&(r.classList.remove("hidden"),r.style.setProperty("display","block","important"),r.style.setProperty("visibility","visible","important"),r.style.setProperty("z-index","99998","important")),!s)if(v&&v.id===e)s=v,g.findIndex(o=>o.id===e)===-1&&g.unshift(s);else return loadActiveChats(!1,!1).then(()=>{s=g.find(i=>i.id===e),s&&(u=e,v=s,G(s),F(e,!0),J(e))});u=e,v=s;const n=document.getElementById("chat_messages");n&&(n.innerHTML=""),G(s),F(e,!0),J(e)};function G(e){const s=document.getElementById("chat_list_view"),t=document.getElementById("chat_messages_view"),r=document.getElementById("chat_header_name"),n=document.getElementById("chat_header_avatar"),i=document.getElementById("chat_user_avatar"),o=document.getElementById("chat_drawer"),d=document.getElementById("chat_drawer_backdrop");if(o){_=!1,o.removeAttribute("data-drawer-closed"),o.classList.remove("hidden"),w=!0;try{o.style.setProperty("display","flex","important"),o.style.setProperty("visibility","visible","important"),o.style.setProperty("opacity","1","important"),o.style.setProperty("z-index","99999","important"),o.style.setProperty("transform","translateX(0)","important"),o.style.setProperty("right","1.25rem","important"),o.style.setProperty("left","unset","important"),o.style.setProperty("transition","none","important"),o.style.setProperty("animation","none","important"),o.setAttribute("data-chat-active","true")}finally{setTimeout(()=>{w=!1},10)}}if(d&&(d.classList.remove("hidden"),d.style.setProperty("display","block","important"),d.style.setProperty("visibility","visible","important"),d.style.setProperty("z-index","99998","important")),s&&(s.style.setProperty("display","none","important"),s.style.setProperty("visibility","hidden","important"),s.style.setProperty("opacity","0","important")),t&&(t.style.setProperty("display","flex","important"),t.style.setProperty("visibility","visible","important"),t.style.setProperty("opacity","1","important"),t.classList.remove("hidden")),e){if(r&&e.candidate&&(r.textContent=e.candidate.name),n&&e.candidate){const c=n.parentElement;if(e.candidate.avatar&&!e.candidate.avatar.includes("/assets/media/avatars/300-5.png"))if(c&&(c.style.overflow="visible"),n.tagName==="SPAN"){const a=document.createElement("img");a.src=e.candidate.avatar,a.alt=e.candidate.name,a.className="w-full h-full rounded-full object-cover",a.style.cssText="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; border-radius: 50%; object-fit: cover;",a.onerror=function(){this.remove(),n.textContent=e.candidate.name.charAt(0).toUpperCase(),n.style.display="block"},n.style.display="none",c.appendChild(a)}else n.tagName==="IMG"&&(n.src=e.candidate.avatar,n.style.cssText="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; border-radius: 50%; object-fit: cover;",n.onerror=function(){const a=this.parentElement;a.innerHTML=`<span class="text-primary font-semibold text-sm" id="chat_header_avatar" style="position: relative; z-index: 1;">${e.candidate.name.charAt(0).toUpperCase()}</span>`});else if(n.tagName==="SPAN")n.textContent=e.candidate.name.charAt(0).toUpperCase(),n.style.display="block";else{const a=n.parentElement;a.innerHTML=`<span class="text-primary font-semibold text-sm" id="chat_header_avatar" style="position: relative; z-index: 1;">${e.candidate.name.charAt(0).toUpperCase()}</span>`}K(e)}i&&e.user&&e.user.avatar&&(i.src=e.user.avatar)}setTimeout(()=>{Z(),ie();const c=document.getElementById("chat_message_input");c&&c.focus()},100)}function K(e,s=null){if(!e||!e.id)return;const t=document.getElementById("chat_header_avatar")?.parentElement;if(!t)return;const r=t.querySelector(".kt-avatar-indicator");r&&r.remove();let n=!1;s&&s.is_online!==void 0?n=s.is_online:e.candidate&&e.candidate.is_online!==void 0&&(n=e.candidate.is_online);const i=document.createElement("div");i.className="kt-avatar-indicator -bottom-2 -end-2",i.innerHTML=`<div class="kt-avatar-status ${n?"kt-avatar-status-online":"kt-avatar-status-offline"}"></div>`,t.appendChild(i)}function ie(){const e=document.querySelector("#chat_messages_view .kt-scrollable-y-auto");e&&(e.removeEventListener("scroll",W),e.addEventListener("scroll",W),N())}function W(){if(j)return;const e=document.querySelector("#chat_messages_view .kt-scrollable-y-auto");if(!e)return;e.scrollHeight-e.scrollTop<=e.clientHeight+50?D=!1:D=!0,N()}window.showChatList=function(){const e=document.getElementById("chat_drawer");u=null,v=null,e&&e.getAttribute("data-user-opened")==="true"&&(e.setAttribute("data-chat-active","true"),e.removeAttribute("data-drawer-closed"),e.classList.remove("hidden"),e.style.setProperty("display","flex","important"),e.style.setProperty("visibility","visible","important"),e.style.setProperty("opacity","1","important"),e.style.setProperty("z-index","99999","important"),e.style.setProperty("transform","translateX(0)","important"),e.style.setProperty("right","1.25rem","important"),e.style.setProperty("left","unset","important"),e.style.setProperty("top","1.25rem","important"),e.style.setProperty("bottom","1.25rem","important"),e.style.setProperty("width","450px","important"),e.style.setProperty("max-width","90%","important"),e.style.setProperty("position","fixed","important"),e.style.setProperty("margin-left","0","important")),loadActiveChats(!0).then(()=>{if(e&&e.getAttribute("data-user-opened")==="true"){e.setAttribute("data-chat-active","true"),e.removeAttribute("data-drawer-closed"),e.classList.remove("hidden"),e.style.setProperty("display","flex","important"),e.style.setProperty("visibility","visible","important"),e.style.setProperty("opacity","1","important"),e.style.setProperty("z-index","99999","important"),e.style.setProperty("transform","translateX(0)","important"),e.style.setProperty("right","1.25rem","important"),e.style.setProperty("left","unset","important"),e.style.setProperty("top","1.25rem","important"),e.style.setProperty("bottom","1.25rem","important"),e.style.setProperty("width","450px","important"),e.style.setProperty("max-width","90%","important"),e.style.setProperty("position","fixed","important"),e.style.setProperty("margin-left","0","important");const s=document.getElementById("chat_drawer_backdrop");s&&(s.classList.remove("hidden"),s.style.setProperty("display","block","important"),s.style.setProperty("visibility","visible","important"))}})};function Z(){const e=document.getElementById("chat_message_input");if(!e)return;const s=e.cloneNode(!0);e.parentNode.replaceChild(s,e);const t=function(){s.style.height="auto",s.style.height=Math.min(s.scrollHeight,200)+"px"};s.addEventListener("keypress",function(n){n.key==="Enter"&&!n.shiftKey?(n.preventDefault(),window.sendMessage&&window.sendMessage()):onChatMessageInput&&onChatMessageInput()}),s.addEventListener("input",function(){t(),onChatMessageInput&&onChatMessageInput()}),t(),setTimeout(()=>{s.focus()},50);const r=document.getElementById("chat_send_button");r&&!r.hasAttribute("data-send-listener-added")&&(r.setAttribute("data-send-listener-added","true"),r.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation(),window.sendMessage&&window.sendMessage()}))}function F(e,s=!1){if(s){const t=document.getElementById("chat_messages_loader");t&&(t.style.display="flex")}if(u!==e){const t=document.getElementById("chat_messages");t&&(t.innerHTML="")}return fetch(`/admin/chat/${e}/messages`,{headers:{"X-CSRF-TOKEN":S()}}).then(t=>{if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(t=>{let r=null;if(Array.isArray(t)?t=t:t&&t.messages&&(r=t.presence,t=t.messages),Array.isArray(t))if(u===e){re(t,e);const n=document.getElementById("chat_messages_loader");n&&(n.style.display="none"),setTimeout(()=>{k()},100);const i=g.findIndex(o=>o.id===e);if(i!==-1){g[i].unread_count=0,Q([g[i]]);const o=g[i];r&&(o.candidate=o.candidate||{},o.candidate.is_online=r.is_online||!1),K(o,r)}}else{const n=document.getElementById("chat_messages_loader");n&&(n.style.display="none")}else{const n=document.getElementById("chat_messages_loader");n&&(n.style.display="none")}return t}).catch(t=>{const r=document.getElementById("chat_messages_loader");throw r&&(r.style.display="none"),t})}function T(){const e=document.getElementById("chat_messages");if(!e)return;const s=Array.from(e.querySelectorAll(".flex.items-end"));if(s.length===0)return;const t=s.map(r=>{const n=r.getAttribute("data-timestamp");let i=null;if(n)i=new Date(n);else{const o=r.querySelector(".text-xs.font-medium");if(o){const d=o.textContent.trim(),c=new Date,[a,f]=d.split(":").map(Number);!isNaN(a)&&!isNaN(f)&&(i=new Date(c.getFullYear(),c.getMonth(),c.getDate(),a,f))}i||(i=new Date)}return{element:r,timestamp:i}});t.sort((r,n)=>r.timestamp.getTime()-n.timestamp.getTime()),t.forEach(({element:r})=>{e.appendChild(r)})}function re(e,s=null){const t=document.getElementById("chat_messages");if(!t||s!==null&&s!==u)return;t.querySelectorAll(".flex.items-end.justify-end").forEach(m=>{const x=m.querySelector(".kt-avatar-indicator");x&&x.remove()}),t.querySelectorAll('[data-optimistic="false"]').forEach(m=>m.remove());const i=Array.from(t.querySelectorAll('[data-optimistic="true"]')),o=i.map(m=>{const x=m.getAttribute("data-message-text")||m.querySelector(".kt-card p")?.textContent||"",h=m.getAttribute("data-optimistic-id"),C=m.getAttribute("data-timestamp"),A=m.getAttribute("data-chat-id");return A&&A!==String(u)?(m.remove(),null):{element:m,text:x,id:h,timestamp:C?new Date(C):new Date}}).filter(m=>m!==null),d=Array.isArray(e)&&e.length>0,c=i.length>0,a=d||c;let f=t.querySelector(".chat-empty-message");if(a?f&&f.remove():f||(f=document.createElement("div"),f.className="chat-empty-message text-center text-muted-foreground p-4",f.textContent="Geen berichten",t.appendChild(f)),!d)return void 0;const l=new Set,p=new Map;Array.from(t.querySelectorAll(".flex.items-end")).forEach(m=>{if(!(m.getAttribute("data-optimistic")==="true")){const h=m.getAttribute("data-message-id");h&&(l.add(h),p.set(h,m))}}),new Set(o.map(({text:m})=>m));const b=e.filter(m=>!(m.id&&l.has(String(m.id))));if(b.length===0){o.forEach(({element:C,text:A,timestamp:$})=>{if(!A||!$)return;const M=e.filter(I=>I.message===A);if(M.length===0)return;let E=null,q=1/0;if(M.forEach(I=>{if(I.created_at){const ee=new Date(I.created_at),U=Math.abs(ee.getTime()-$.getTime());U<q&&(q=U,E=I)}}),E&&q<5e3){const I=t.querySelector(`[data-optimistic="false"][data-message-id="${E.id}"]`);I&&I.offsetParent!==null&&(C.remove(),T())}}),T();const x=t.querySelectorAll(".flex.items-end").length>0;let h=t.querySelector(".chat-empty-message");x?h&&h.remove():h||(h=document.createElement("div"),h.className="chat-empty-message text-center text-muted-foreground p-4",h.textContent="Geen berichten",t.appendChild(h)),k();return}const z=b.map(m=>{const x=m.is_own;if(m.sender_name&&m.sender_name.charAt(0).toUpperCase(),x){const h=v&&v.user&&v.user.avatar?v.user.avatar:"/assets/media/avatars/300-2.png",C=m.created_at?new Date(m.created_at).toISOString():new Date().toISOString();return`
                <div class="flex items-end justify-end gap-3.5 px-5" data-optimistic="false" data-message-id="${m.id||""}" data-message-text="${P(m.message)}" data-timestamp="${C}" data-chat-id="${u||""}">
                    <div class="flex flex-col gap-1.5">
                        <div class="kt-card bg-primary rounded-be-none flex flex-col gap-2.5 p-3 shadow-none">
                            <p class="text-2sm text-primary-foreground font-medium">${P(m.message)}</p>
                        </div>
                        <div class="relative flex items-center justify-end gap-2">
                            <span class="text-xs font-medium text-secondary-foreground">${m.time}</span>
                            ${m.is_read!==void 0?`<i class="ki-filled ki-double-check text-lg ${m.is_read?"text-green-500":"text-gray-400"}"></i>`:""}
                        </div>
                    </div>
                    <div class="relative shrink-0">
                        <div class="kt-avatar size-9">
                            <div class="kt-avatar-image">
                                <img alt="${m.sender_name}" class="size-9 rounded-full object-cover" src="${h}" />
                            </div>
                        </div>
                    </div>
                </div>
            `}else{const h=m.sender_avatar||"/assets/media/avatars/300-5.png";m.user&&m.user.is_online!==void 0&&m.user.is_online;const C=m.created_at?new Date(m.created_at).toISOString():new Date().toISOString();return`
                <div class="flex items-end gap-3.5 px-5" data-optimistic="false" data-message-id="${m.id||""}" data-message-text="${P(m.message)}" data-timestamp="${C}" data-chat-id="${u||""}">
                    <div class="relative shrink-0">
                        <div class="kt-avatar size-9">
                            <div class="kt-avatar-image">
                                <img alt="${P(m.sender_name)}" class="size-9 rounded-full object-cover" src="${P(h)}" onerror="this.src='/assets/media/avatars/300-5.png'" />
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col gap-1.5">
                        <div class="kt-card bg-accent/60 rounded-bs-none text-2sm flex flex-col gap-2.5 p-3 shadow-none relative">
                            ${P(m.message)}
                        </div>
                        <div class="relative flex items-center gap-2">
                            <span class="text-xs font-medium text-muted-foreground">${m.time}</span>
                            ${m.is_read!==void 0?`<i class="ki-filled ki-double-check text-lg ${m.is_read?"text-green-500":"text-gray-400"}"></i>`:""}
                        </div>
                    </div>
                </div>
            `}}).join("");z&&t.insertAdjacentHTML("beforeend",z),T(),k(),o.forEach(({element:m,text:x,timestamp:h,id:C})=>{if(!m||!m.parentNode||!x||!h)return;const A=e.filter(E=>E.message===x);if(A.length===0)return;let $=null,M=1/0;A.forEach(E=>{if(E.created_at){const q=new Date(E.created_at),I=Math.abs(q.getTime()-h.getTime());I<M&&(M=I,$=E)}}),$&&M<5e3&&setTimeout(()=>{if(m&&m.parentNode){const E=t.querySelector(`[data-optimistic="false"][data-message-id="${$.id}"]`);E&&E.offsetParent!==null&&(m.remove(),T(),k())}},150)}),requestAnimationFrame(()=>{const x=t.querySelectorAll(".flex.items-end").length>0;let h=t.querySelector(".chat-empty-message");x?h&&h.remove():h||(h=document.createElement("div"),h.className="chat-empty-message text-center text-muted-foreground p-4",h.textContent="Geen berichten",t.appendChild(h))})}function ae(e,s=!1){const t=document.getElementById("chat_messages");if(!t)return null;const r=t.querySelector(".chat-empty-message");r&&r.remove();const n=v&&v.user&&v.user.avatar?v.user.avatar:"/assets/media/avatars/300-2.png",i=new Date,o=i.toLocaleTimeString("nl-NL",{hour:"2-digit",minute:"2-digit"}),d=i.toISOString(),c=s?`optimistic-${Date.now()}-${Math.random().toString(36).substr(2,9)}`:null,a=document.createElement("div");return a.className="flex items-end justify-end gap-3.5 px-5",a.setAttribute("data-optimistic",s?"true":"false"),a.setAttribute("data-message-text",P(e)),a.setAttribute("data-timestamp",d),a.setAttribute("data-chat-id",String(u||"")),c&&a.setAttribute("data-optimistic-id",c),a.innerHTML=`
        <div class="flex flex-col gap-1.5">
            <div class="kt-card bg-primary rounded-be-none flex flex-col gap-2.5 p-3 shadow-none">
                <p class="text-2sm text-primary-foreground font-medium">${P(e)}</p>
            </div>
            <div class="relative flex items-center justify-end gap-2">
                <span class="text-xs font-medium text-secondary-foreground">${o}</span>
                ${s?'<i class="ki-filled ki-time text-lg text-gray-400"></i>':""}
            </div>
        </div>
        <div class="relative shrink-0">
            <div class="kt-avatar size-9">
                <div class="kt-avatar-image">
                    <img alt="You" class="size-9 rounded-full object-cover" src="${n}" />
                </div>
            </div>
        </div>
    `,t.appendChild(a),T(),k(),a}window.sendMessage=function(){const e=document.getElementById("chat_message_input");if(!e||!e.value||!e.value.trim()||!u)return;const s=e.value.trim(),t=ae(s,!0);e.value="",e.style&&(e.style.height="auto");const r=new FormData;r.append("message",s);const n=S();if(!n){t&&t.remove(),e.value=s;return}fetch(`/admin/chat/${u}/message`,{method:"POST",headers:{"X-CSRF-TOKEN":n,Accept:"application/json"},body:r}).then(i=>i.ok?i.json():i.text().then(o=>{throw new Error(`HTTP error! status: ${i.status}, body: ${o}`)})).then(i=>{if(i.success&&i.message){const o=document.getElementById("chat_messages");let d=!1;if(o)if(i.message.id?o.querySelector(`[data-optimistic="false"][data-message-id="${i.message.id}"]`):null)t&&t.remove();else{const a=v&&v.user&&v.user.avatar?v.user.avatar:"/assets/media/avatars/300-2.png",f=i.message.created_at?new Date(i.message.created_at).toISOString():new Date().toISOString(),l=`
                        <div class="flex items-end justify-end gap-3.5 px-5" data-optimistic="false" data-message-id="${i.message.id||""}" data-message-text="${P(i.message.message)}" data-timestamp="${f}" data-chat-id="${u||""}">
                            <div class="flex flex-col gap-1.5">
                                <div class="kt-card bg-primary rounded-be-none flex flex-col gap-2.5 p-3 shadow-none">
                                    <p class="text-2sm text-primary-foreground font-medium">${P(i.message.message)}</p>
                                </div>
                                <div class="relative flex items-center justify-end gap-2">
                                    <span class="text-xs font-medium text-secondary-foreground">${i.message.time}</span>
                                    ${i.message.is_read!==void 0?`<i class="ki-filled ki-double-check text-lg ${i.message.is_read?"text-green-500":"text-gray-400"}"></i>`:""}
                                </div>
                            </div>
                            <div class="relative shrink-0">
                                <div class="kt-avatar size-9">
                                    <div class="kt-avatar-image">
                                        <img alt="${i.message.sender_name}" class="size-9 rounded-full object-cover" src="${a}" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;o.insertAdjacentHTML("beforeend",l),d=!0,v&&K(v),T(),k(),requestAnimationFrame(()=>{const p=o.querySelector(`[data-optimistic="false"][data-message-id="${i.message.id||""}"]`);p&&p.offsetParent!==null?t&&t.parentNode&&(t.remove(),T(),k()):setTimeout(()=>{const y=o.querySelector(`[data-optimistic="false"][data-message-id="${i.message.id||""}"]`);y&&y.offsetParent!==null&&t&&t.parentNode&&(t.remove(),T(),k())},50)}),k()}if(v&&i.message){v.last_message={message:i.message.message,created_at:i.message.created_at,time:i.message.time};const c=g.findIndex(a=>a.id===u);c!==-1&&(g[c].last_message=v.last_message,g[c].updated_at=i.message.created_at||new Date().toISOString(),g[c].is_active=!0,g[c].is_ended_by_other_party=!1,g[c].is_ended_by_current_user=!1,g[c].ended_at=null)}te(u),d&&(setTimeout(()=>{F(u,!1)},500),setTimeout(()=>{const c=document.getElementById("chat_list_view");c&&window.getComputedStyle(c).display!=="none"?(O(g),loadActiveChats(!1).then(()=>{O(g)})):loadActiveChats(!1)},600))}else t&&t.remove(),e.value=s}).catch(i=>{t&&t.remove(),e.value=s})};window.handleDrawerClose=function(){const e=document.getElementById("chat_drawer"),s=document.getElementById("chat_drawer_backdrop");if(!e)return;if(e.getAttribute("data-user-opened")==="true"){e.classList.remove("hidden"),e.removeAttribute("data-drawer-closed"),e.style.setProperty("display","flex","important"),e.style.setProperty("visibility","visible","important"),e.style.setProperty("opacity","1","important");return}_=!0,u=null,v=null;const t=()=>{e&&(e.setAttribute("data-drawer-closed","true"),e.removeAttribute("style"),e.classList.add("hidden"),e.removeAttribute("data-chat-active"),e.style.cssText="display: none !important; visibility: hidden !important; opacity: 0 !important; transform: translateX(100%) !important; right: -100% !important; left: unset !important; z-index: -1 !important;",e.classList.remove("open"))},r=()=>{s&&(s.removeAttribute("style"),s.classList.add("hidden"),s.style.cssText="display: none !important; visibility: hidden !important; opacity: 0 !important; z-index: -1 !important;")};if(window.KTDrawer){const c=window.KTDrawer.getInstance(e);if(c)try{c.hide()}catch{}}const n=document.querySelector('[data-kt-drawer-toggle="#chat_drawer"]');if(n&&(!e.classList.contains("hidden")||window.getComputedStyle(e).display!=="none"))try{n.click()}catch{}t(),r(),[0,10,50,100,200,300,500,1e3].forEach(c=>{setTimeout(()=>{t(),r()},c)});let o=0;const d=setInterval(()=>{e&&_?(t(),r(),o++,o>=30&&clearInterval(d)):clearInterval(d)},100)};window.endChat=function(){if(!u)return;const e=document.documentElement.classList.contains("dark"),s=document.createElement("div");s.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: ${e?"rgba(0, 0, 0, 0.7)":"rgba(0, 0, 0, 0.5)"};
        z-index: 999999;
        display: flex;
        align-items: center;
        justify-content: center;
    `;const t=document.createElement("div");t.style.cssText=`
        background-color: ${e?"#1e293b":"#ffffff"};
        color: ${e?"#f1f5f9":"#1e293b"};
        border: 1px solid ${e?"#334155":"#e2e8f0"};
        border-radius: 0.5rem;
        padding: 1.5rem;
        max-width: 400px;
        width: 90%;
        box-shadow: ${e?"0 20px 25px -5px rgba(0, 0, 0, 0.5)":"0 20px 25px -5px rgba(0, 0, 0, 0.1)"};
    `,t.innerHTML=`
        <div style="margin-bottom: 1rem;">
            <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: ${e?"#f1f5f9":"#1e293b"};">
                Chat beëindigen
            </h3>
            <p style="color: ${e?"#cbd5e1":"#64748b"};">
                Weet je zeker dat je deze chat wilt beëindigen?
            </p>
        </div>
        <div style="display: flex; gap: 0.75rem; justify-content: flex-end;">
            <button id="end-cancel-btn" style="
                padding: 0.5rem 1rem;
                border-radius: 0.375rem;
                border: 1px solid ${e?"#475569":"#cbd5e1"};
                background-color: ${e?"#334155":"#f1f5f9"};
                color: ${e?"#f1f5f9":"#1e293b"};
                cursor: pointer;
                font-weight: 500;
                transition: all 0.2s;
            ">
                Annuleren
            </button>
            <button id="end-confirm-btn" style="
                padding: 0.5rem 1rem;
                border-radius: 0.375rem;
                border: none;
                background-color: #dc2626;
                color: white;
                cursor: pointer;
                font-weight: 500;
                transition: all 0.2s;
            ">
                Beëindigen
            </button>
        </div>
    `,s.appendChild(t),document.body.appendChild(s);const r=t.querySelector("#end-cancel-btn"),n=t.querySelector("#end-confirm-btn");return r.addEventListener("mouseenter",()=>{r.style.backgroundColor=e?"#475569":"#e2e8f0"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor=e?"#334155":"#f1f5f9"}),n.addEventListener("mouseenter",()=>{n.style.backgroundColor="#b91c1c"}),n.addEventListener("mouseleave",()=>{n.style.backgroundColor="#dc2626"}),new Promise(i=>{r.addEventListener("click",()=>{document.body.removeChild(s),i(!1)}),n.addEventListener("click",()=>{document.body.removeChild(s),i(!0)}),s.addEventListener("click",o=>{o.target===s&&(document.body.removeChild(s),i(!1))})}).then(i=>{i&&fetch(`/admin/chat/${u}/end`,{method:"POST",headers:{"X-CSRF-TOKEN":S()}}).then(o=>o.json()).then(o=>{if(o.success){u=null,v=null;const d=document.getElementById("chat_drawer");d&&d.removeAttribute("data-chat-active"),loadActiveChats()}}).catch(o=>{})})};window.deleteChat=function(){if(!u)return;const e=document.documentElement.classList.contains("dark"),s=document.createElement("div");s.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: ${e?"rgba(0, 0, 0, 0.7)":"rgba(0, 0, 0, 0.5)"};
        z-index: 999999;
        display: flex;
        align-items: center;
        justify-content: center;
    `;const t=document.createElement("div");t.style.cssText=`
        background-color: ${e?"#1e293b":"#ffffff"};
        color: ${e?"#f1f5f9":"#1e293b"};
        border: 1px solid ${e?"#334155":"#e2e8f0"};
        border-radius: 0.5rem;
        padding: 1.5rem;
        max-width: 400px;
        width: 90%;
        box-shadow: ${e?"0 20px 25px -5px rgba(0, 0, 0, 0.5)":"0 20px 25px -5px rgba(0, 0, 0, 0.1)"};
    `,t.innerHTML=`
        <div style="margin-bottom: 1rem;">
            <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; color: ${e?"#f1f5f9":"#1e293b"};">
                Chat verwijderen
            </h3>
            <p style="color: ${e?"#cbd5e1":"#64748b"};">
                Weet je zeker dat je deze chat wilt verwijderen? Deze actie kan niet ongedaan worden gemaakt.
            </p>
        </div>
        <div style="display: flex; gap: 0.75rem; justify-content: flex-end;">
            <button id="delete-cancel-btn" style="
                padding: 0.5rem 1rem;
                border-radius: 0.375rem;
                border: 1px solid ${e?"#475569":"#cbd5e1"};
                background-color: ${e?"#334155":"#f1f5f9"};
                color: ${e?"#f1f5f9":"#1e293b"};
                cursor: pointer;
                font-weight: 500;
                transition: all 0.2s;
            ">
                Annuleren
            </button>
            <button id="delete-confirm-btn" style="
                padding: 0.5rem 1rem;
                border-radius: 0.375rem;
                border: none;
                background-color: #dc2626;
                color: white;
                cursor: pointer;
                font-weight: 500;
                transition: all 0.2s;
            ">
                Verwijderen
            </button>
        </div>
    `,s.appendChild(t),document.body.appendChild(s);const r=t.querySelector("#delete-cancel-btn"),n=t.querySelector("#delete-confirm-btn");return r.addEventListener("mouseenter",()=>{r.style.backgroundColor=e?"#475569":"#e2e8f0"}),r.addEventListener("mouseleave",()=>{r.style.backgroundColor=e?"#334155":"#f1f5f9"}),n.addEventListener("mouseenter",()=>{n.style.backgroundColor="#b91c1c"}),n.addEventListener("mouseleave",()=>{n.style.backgroundColor="#dc2626"}),new Promise(i=>{r.addEventListener("click",()=>{document.body.removeChild(s),i(!1)}),n.addEventListener("click",()=>{document.body.removeChild(s),i(!0)}),s.addEventListener("click",o=>{o.target===s&&(document.body.removeChild(s),i(!1))})}).then(i=>{if(!i)return;const o=u;o&&fetch(`/admin/chat/${o}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":S()}}).then(d=>d.json()).then(d=>{if(d.success){g=g.filter(y=>y.id!==o),u===o&&(u=null,v=null);const c=document.getElementById("chat_messages");c&&(c.innerHTML="");const a=document.getElementById("chat_drawer");if(a){window.chatDrawerObserver&&window.chatDrawerObserver.disconnect(),a.setAttribute("data-user-opened","true"),a.setAttribute("data-chat-active","true"),a.removeAttribute("data-drawer-closed"),a.classList.remove("hidden"),a.style.setProperty("display","flex","important"),a.style.setProperty("visibility","visible","important"),a.style.setProperty("opacity","1","important"),a.style.setProperty("z-index","99999","important"),a.style.setProperty("transform","translateX(0)","important"),a.style.setProperty("translate","0 0","important"),a.style.setProperty("right","1.25rem","important"),a.style.setProperty("left","auto","important"),a.style.setProperty("--tw-translate-x","0","important"),a.style.setProperty("inset-inline-start","auto","important"),a.style.setProperty("top","1.25rem","important"),a.style.setProperty("bottom","1.25rem","important"),a.style.setProperty("width","450px","important"),a.style.setProperty("max-width","90%","important"),a.style.setProperty("position","fixed","important"),a.style.setProperty("margin-left","0","important");const y=document.getElementById("chat_drawer_backdrop");y&&(y.classList.remove("hidden"),y.style.setProperty("display","block","important"),y.style.setProperty("visibility","visible","important"),y.style.setProperty("z-index","99998","important")),setTimeout(()=>{window.chatDrawerObserver&&a&&a.getAttribute("data-user-opened")==="true"&&window.chatDrawerObserver.observe(a,{attributes:!0,attributeFilter:["class"]})},500)}const f=document.getElementById("chat_list");if(f){const y=f.querySelector(`.chat-item[data-chat-id="${o}"]`);y?y.remove():O(g)}const l=document.getElementById("chat_list_view"),p=document.getElementById("chat_messages_view");l&&(l.style.setProperty("display","flex","important"),l.style.setProperty("visibility","visible","important"),l.style.setProperty("opacity","1","important")),p&&(p.style.setProperty("display","none","important"),p.style.setProperty("visibility","hidden","important"),p.style.setProperty("opacity","0","important"))}}).catch(d=>{})})};function J(e){X&&clearInterval(X),V&&clearInterval(V),R&&clearInterval(R),H()&&Y(e),X=setInterval(()=>{u&&H()&&F(u)},500),V=setInterval(()=>{u&&H()&&ne(u)},1e3),R=setInterval(()=>{u&&H()&&Y(u)},8e3)}function H(){return typeof document.hidden<"u"?!document.hidden:!0}function Y(e){fetch(`/admin/chat/${e}/presence`,{method:"POST",headers:{"X-CSRF-TOKEN":S()},keepalive:!0}).catch(s=>{})}function ne(e){fetch(`/admin/chat/${e}/typing`,{headers:{"X-CSRF-TOKEN":S()}}).then(s=>s.json()).then(s=>{const t=document.getElementById("chat_typing_indicator_header");if(t)if(s.length>0){const r=s.map(n=>n.name).join(", ");t.textContent=`${r} ${s.length===1?"is":"zijn"} aan het typen...`,t.style.display="block"}else t.style.display="none"}).catch(s=>{})}window.onChatMessageInput=function(){!document.getElementById("chat_message_input")||!u||fetch(`/admin/chat/${u}/typing`,{method:"POST",headers:{"X-CSRF-TOKEN":S()}})};function k(e=!1){if(!e&&D){N();return}requestAnimationFrame(()=>{const s=document.getElementById("chat_messages");if(s){const t=s.closest(".kt-scrollable-y-auto");t?(j=!0,t.scrollTop=t.scrollHeight,setTimeout(()=>{j=!1,D=!1,N()},100)):(j=!0,s.scrollTop=s.scrollHeight,setTimeout(()=>{j=!1,D=!1,N()},100))}})}function N(){const e=document.querySelector("#chat_messages_view .kt-scrollable-y-auto"),s=document.getElementById("scroll_to_bottom_btn");if(!e||!s)return;e.scrollHeight-e.scrollTop<=e.clientHeight+50?s.style.display="none":s.style.display="flex"}window.scrollToBottomManually=function(){D=!1,k(!0)};function P(e){const s=document.createElement("div");return s.textContent=e,s.innerHTML}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("chat_drawer"),s=document.getElementById("chat_drawer_backdrop");if(e&&(e.classList.add("hidden"),e.style.display="none",e.style.visibility="hidden",e.style.opacity="0"),s&&(s.classList.add("hidden"),s.style.display="none",s.style.visibility="hidden"),e){let n=new MutationObserver(function(o){o.forEach(function(d){if(d.type==="attributes"&&d.attributeName==="class"){if(e&&e.getAttribute("data-ignore-observer")==="true"||_||e&&e.getAttribute("data-drawer-closed")==="true")return;if(!e.classList.contains("hidden")){if(L||w)return;w=!0;try{e.style.setProperty("display","flex","important"),e.style.setProperty("visibility","visible","important"),e.style.setProperty("opacity","1","important"),e.style.setProperty("z-index","99999","important"),e.style.setProperty("transform","translateX(0)","important"),e.style.setProperty("right","1.25rem","important"),e.style.setProperty("left","auto","important"),s.style.setProperty("display","block","important"),s.style.setProperty("visibility","visible","important"),s.style.setProperty("z-index","99998","important")}finally{setTimeout(()=>{w=!1},10)}s&&s.classList.remove("hidden");const a=document.getElementById("chat_list_view"),f=document.getElementById("chat_messages_view");u?(a&&(a.style.setProperty("display","none","important"),a.style.setProperty("visibility","hidden","important"),a.style.setProperty("opacity","0","important")),f&&(f.style.setProperty("display","flex","important"),f.style.setProperty("visibility","visible","important"),f.style.setProperty("opacity","1","important"),f.classList.remove("hidden"))):(a&&(a.style.setProperty("display","flex","important"),a.style.setProperty("visibility","visible","important"),a.style.setProperty("opacity","1","important")),f&&(f.style.setProperty("display","none","important"),f.style.setProperty("visibility","hidden","important"),f.style.setProperty("opacity","0","important"))),loadActiveChats(!1,!1).then(()=>{u||O(g)}),setTimeout(()=>{const l=document.getElementById("chat_candidate_select");l&&!l.hasAttribute("data-listener-attached")&&(l.addEventListener("change",handleCandidateSelect),l.setAttribute("data-listener-attached","true"))},100)}else{const a=u||L||e?.getAttribute("data-chat-active")==="true",f=e?.getAttribute("data-user-opened")==="true";if(a||f){if(e&&(e.classList.remove("hidden"),e.removeAttribute("data-drawer-closed"),!w)){w=!0;try{e.style.setProperty("display","flex","important"),e.style.setProperty("visibility","visible","important"),e.style.setProperty("opacity","1","important"),e.style.setProperty("z-index","99999","important"),e.style.setProperty("transform","translateX(0)","important"),e.style.setProperty("right","1.25rem","important"),e.style.setProperty("left","auto","important"),f&&e.setAttribute("data-chat-active","true")}finally{setTimeout(()=>{w=!1},10)}}s&&(s.classList.remove("hidden"),s.style.display="block",s.style.visibility="visible")}else{if(e&&e.getAttribute("data-user-opened")==="true")return;e&&(e.removeAttribute("data-chat-active"),e.removeAttribute("data-user-opened"),e.setAttribute("data-drawer-closed","true"),e.style.display="none",e.style.visibility="hidden",e.style.opacity="0"),s&&(s.classList.add("hidden"),s.style.display="none",s.style.visibility="hidden")}}}})});window.chatDrawerObserver=n,n.observe(e,{attributes:!0,attributeFilter:["class"]}),new MutationObserver(function(o){w||_||e&&e.getAttribute("data-drawer-closed")==="true"||e&&e.getAttribute("data-chat-active")==="true"&&requestAnimationFrame(()=>{if(w)return;const d=window.getComputedStyle(e).transform,c=window.getComputedStyle(e).right,a=window.getComputedStyle(e).left,f=d!=="none"&&d!=="matrix(1, 0, 0, 1, 0, 0)",l=c!=="1.25rem"&&c!=="20px",p=a!=="auto"&&a!=="unset";if(f||l||p){w=!0;try{if(f&&e.style.setProperty("transform","translateX(0)","important"),l&&e.style.setProperty("right","1.25rem","important"),p){e.style.left&&e.style.removeProperty("left");const y=e.getAttribute("style");if(y){const b=y.replace(/left\s*:\s*[^;!]+(!important)?;?/gi,"").trim();b!==y&&e.setAttribute("style",b)}e.style.setProperty("left","auto","important")}}finally{setTimeout(()=>{w=!1},50)}}})}).observe(e,{attributes:!0,attributeFilter:["style","class"],attributeOldValue:!1,childList:!1,subtree:!1}),setInterval(function(){if(w)return;const o=e&&e.getAttribute("data-user-opened")==="true";if((_||e&&e.getAttribute("data-drawer-closed")==="true")&&!o){e&&(e.setAttribute("data-drawer-closed","true"),e.classList.add("hidden"),e.removeAttribute("data-chat-active"),e.style.setProperty("display","none","important"),e.style.setProperty("visibility","hidden","important"),e.style.setProperty("opacity","0","important"),e.style.setProperty("transform","translateX(100%)","important"),e.style.setProperty("right","-100%","important"),e.style.setProperty("z-index","-1","important"),e.classList.remove("open")),s&&(s.classList.add("hidden"),s.style.setProperty("display","none","important"),s.style.setProperty("visibility","hidden","important"),s.style.setProperty("opacity","0","important"),s.style.setProperty("z-index","-1","important"));return}o&&e&&(e.setAttribute("data-chat-active","true"),e.removeAttribute("data-drawer-closed"),e.classList.remove("hidden"),e.style.setProperty("display","flex","important"),e.style.setProperty("visibility","visible","important"),e.style.setProperty("opacity","1","important"),e.style.setProperty("z-index","99999","important"),e.style.setProperty("transform","translateX(0)","important"),e.style.setProperty("right","1.25rem","important"),e.style.setProperty("left","unset","important"),e.style.setProperty("top","1.25rem","important"),e.style.setProperty("bottom","1.25rem","important"),e.style.setProperty("width","450px","important"),e.style.setProperty("max-width","90%","important"),e.style.setProperty("position","fixed","important"),e.style.setProperty("margin-left","0","important"),s&&(s.classList.remove("hidden"),s.style.setProperty("display","block","important"),s.style.setProperty("visibility","visible","important"),s.style.setProperty("z-index","99998","important")));const d=u||L||e&&e.getAttribute("data-chat-active")==="true";if(d&&e){const c=e.classList.contains("hidden"),a=window.getComputedStyle(e).display;(c||a==="none")&&e.classList.remove("hidden"),w=!0;try{e.style.setProperty("display","flex","important"),e.style.setProperty("visibility","visible","important"),e.style.setProperty("opacity","1","important"),e.style.setProperty("z-index","99999","important"),e.style.setProperty("transform","translateX(0)","important"),e.style.setProperty("translate","0 0","important"),e.style.setProperty("right","1.25rem","important"),e.style.setProperty("left","auto","important"),e.style.setProperty("top","1.25rem","important"),e.style.setProperty("bottom","1.25rem","important"),e.style.setProperty("width","450px","important"),e.style.setProperty("max-width","90%","important"),e.style.setProperty("position","fixed","important"),e.style.setProperty("margin-left","0","important"),e.style.setProperty("inset-inline-start","auto","important"),e.style.setProperty("--tw-translate-x","0","important"),e.setAttribute("data-chat-active","true"),e.style.left&&e.style.removeProperty("left"),e.style.setProperty("left","auto","important");const y=e.getAttribute("style");if(y){const b=y.replace(/left\s*:\s*[^;!]+(!important)?;?/gi,"").trim();b!==y&&e.setAttribute("style",b)}e.style.setProperty("left","auto","important"),e.style.setProperty("transition","none","important"),e.style.setProperty("animation","none","important")}finally{setTimeout(()=>{w=!1},10)}const f=window.getComputedStyle(e).transform,l=window.getComputedStyle(e).right,p=window.getComputedStyle(e).left;if(f!=="none"&&f!=="matrix(1, 0, 0, 1, 0, 0)"&&e.style.setProperty("transform","translateX(0)","important"),l!=="1.25rem"&&l!=="20px"&&e.style.setProperty("right","1.25rem","important"),p!=="unset"&&p!=="auto"){e.style.left&&e.style.removeProperty("left");const y=e.getAttribute("style");if(y){const b=y.replace(/left\s*:\s*[^;!]+(!important)?;?/gi,"").trim();b!==y&&e.setAttribute("style",b)}e.style.setProperty("left","auto","important")}s&&(s.classList.remove("hidden"),s.style.setProperty("display","block","important"),s.style.setProperty("visibility","visible","important"),s.style.setProperty("z-index","99998","important"))}else!d&&e&&e.getAttribute("data-chat-active")==="true"&&e.removeAttribute("data-chat-active")},200)}s&&s.addEventListener("click",function(){const n=document.getElementById("chat_drawer");n&&n.getAttribute("data-user-opened")==="true"||window.handleDrawerClose&&window.handleDrawerClose()});const t=document.querySelector('[data-kt-drawer-toggle="#chat_drawer"]');t&&t.addEventListener("click",function(n){e&&(e.classList.contains("hidden")||window.getComputedStyle(e).display==="none")?(_=!1,e&&e.removeAttribute("data-drawer-closed")):(_=!0,e&&e.setAttribute("data-drawer-closed","true")),setTimeout(()=>{e&&(e.classList.contains("hidden")||window.getComputedStyle(e).display==="none")?(_=!0,e&&e.setAttribute("data-drawer-closed","true")):(_=!1,e&&e.removeAttribute("data-drawer-closed"))},50);const o=()=>{e&&(e.classList.remove("hidden"),e.style.setProperty("display","flex","important"),e.style.setProperty("visibility","visible","important"),e.style.setProperty("opacity","1","important"),e.style.setProperty("z-index","99999","important"),e.style.setProperty("transform","translateX(0)","important"),e.style.setProperty("right","1.25rem","important"),e.style.setProperty("left","auto","important"),e.style.setProperty("transition","none","important"),e.style.setProperty("animation","none","important")),s&&(s.classList.remove("hidden"),s.style.setProperty("display","block","important"),s.style.setProperty("visibility","visible","important"),s.style.setProperty("z-index","99998","important"))};o(),requestAnimationFrame(()=>{o(),requestAnimationFrame(()=>{o()})}),setTimeout(o,10),setTimeout(o,50),setTimeout(o,100),setTimeout(o,200)}),e&&e.querySelectorAll('[data-kt-drawer-dismiss="true"]').forEach(i=>{i.addEventListener("click",function(o){o.preventDefault(),o.stopPropagation(),window.handleDrawerClose&&window.handleDrawerClose()})});const r=document.getElementById("chat_candidate_select");r&&r.addEventListener("change",handleCandidateSelect),setTimeout(()=>{Z()},500),setInterval(()=>{if(!u&&!B){const n=document.getElementById("chat_list_view");n&&window.getComputedStyle(n).display!=="none"&&window.getComputedStyle(n).visibility!=="hidden"&&loadActiveChats(!0,!1)}},3e4),document.addEventListener("keydown",function(n){if(n.key==="Escape"||n.keyCode===27){const i=document.getElementById("chat_drawer");if(i&&window.getComputedStyle(i).display!=="none"&&!i.classList.contains("hidden"))if(n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),window.handleDrawerClose)window.handleDrawerClose();else{i.classList.add("hidden"),i.style.cssText="display: none !important; visibility: hidden !important; opacity: 0 !important;";const c=document.getElementById("chat_drawer_backdrop");c&&(c.classList.add("hidden"),c.style.cssText="display: none !important; visibility: hidden !important; opacity: 0 !important;")}}},!0),document.addEventListener("click",function(n){const i=document.getElementById("chat_drawer"),o=document.getElementById("chat_drawer_backdrop");if(!i||_||i.getAttribute("data-drawer-closed")==="true"||!(window.getComputedStyle(i).display!=="none"&&!i.classList.contains("hidden")))return;const a=n.target,f=i.contains(a);o&&(o===a||o.contains(a));const l=a.closest('[data-kt-drawer-toggle="#chat_drawer"]');if(!f&&!l){if(i.getAttribute("data-user-opened")==="true")return;window.handleDrawerClose&&window.handleDrawerClose()}})});
